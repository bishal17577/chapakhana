<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RX XTHA</title>
    
    <!-- PWA Manifest for "Add to Home Screen" - You would create this file -->
    <!-- <link rel="manifest" href="manifest.json"> -->
    <meta name="theme-color" content="#ffffff">
    
    <style>
        /* --- Popup Styles --- */
.popup-bg {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.7);
  z-index: 9999;
}

.popup-box {
  position: relative;
  width: 90%;
  max-width: 400px;
  margin: 10% auto;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  text-align: center;
}

.popup-box img {
  width: 100%;
  height: auto;
  display: block;
}

.close-btn {
  position: absolute;
  top: 5px;
  right: 10px;
  font-size: 25px;
  color: white;
  background: rgba(0,0,0,0.5);
  border-radius: 50%;
  width: 30px;
  height: 30px;
  line-height: 28px;
  text-align: center;
  cursor: pointer;
}

        /* ---- Google Fonts & CSS Reset ---- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* ---- Root Variables for Theming & Design System ---- */
        :root {
            /* Dynamic Font Size for Accessibility */
            font-size: 16px;

            /* Color Palette */
            --primary-color: #0d6efd;
            --secondary-color: #ffc107;
            --gradient-primary: linear-gradient(135deg, #0d6efd, #0b5ed7);
            --gradient-accent: linear-gradient(to right, #ffc107, #fca311);

            /* Light Theme (Default) */
            --bg-body: #f8f9fa; --bg-card: #ffffff; --bg-input: #f1f3f5; --bg-image: #e9ecef; --bg-overlay: hsla(0, 0%, 100%, 0.7); --text-primary: #212529; --text-secondary: #6c757d; --border-color: #dee2e6; --shadow-color-strong: rgba(13, 110, 253, 0.25);

            /* Utility Colors */
            --color-white: #ffffff; --color-danger: #dc3545; --color-success: #198754; --color-info: #0dcaf0;

            /* Design System Tokens */
            --radius-small: 8px; --radius-medium: 16px; --radius-pill: 99px;
            --shadow-soft: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.07);
            --shadow-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            --shadow-strong: 0 8px 30px var(--shadow-color-strong);
            --transition: 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        /* Advanced Theming with data-attributes */
        body[data-theme="dark"] {
            --bg-body: #1a202c; --bg-card: #2d3748; --bg-input: #1a202c; --bg-image: #2d3748; --bg-overlay: hsla(222, 21%, 14%, 0.7); --text-primary: #e2e8f0; --text-secondary: #a0aec0; --border-color: #4a5568; --shadow-color-strong: rgba(101, 199, 247, 0.2);
        }
        body[data-theme="sepia"] {
            --bg-body: #f1e7d0; --bg-card: #fbf1e2; --bg-input: #e2d8c3; --bg-image: #e2d8c3; --bg-overlay: hsla(38, 41%, 91%, 0.7); --text-primary: #5b4636; --text-secondary: #8d745c; --border-color: #d3c4a8; --primary-color: #8c5a32;
        }

        /* ---- Base & Typography Styles ---- */
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-body); color: var(--text-primary); line-height: 1.7; padding-bottom: 80px; -webkit-font-smoothing: antialiased; transition: background-color var(--transition), color var(--transition); }
        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
        .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

        /* ---- Header & Navigation ---- */
        .main-header { background-color: var(--bg-overlay); backdrop-filter: saturate(180%) blur(10px); padding: 12px 0; border-bottom: 1px solid var(--border-color); position: sticky; top: 0; z-index: 1000; transition: background-color var(--transition), border-color var(--transition); }
        .header-content { display: flex; justify-content: space-between; align-items: center; gap: 20px; }
        .logo-area .shop-name { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .search-bar-wrapper { position: relative; flex-grow: 1; max-width: 550px; }
        .search-bar-wrapper input { width: 100%; padding: 12px 45px 12px 20px; border: 1px solid var(--border-color); border-radius: var(--radius-pill); font-size: 1rem; background-color: var(--bg-input); color: var(--text-primary); transition: all var(--transition); }
        .search-bar-wrapper input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px hsla(217, 98%, 52%, 0.2); }
        #clear-search-btn { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); cursor: pointer; display: none; }
        .search-bar-wrapper input:not(:placeholder-shown) ~ #clear-search-btn { display: block; }
        
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .header-icon-btn { background: none; border: none; font-size: 1.4rem; cursor: pointer; color: var(--text-secondary); transition: color var(--transition); position: relative; padding: 5px;}
        .header-icon-btn:hover { color: var(--text-primary); }
        #cart-badge { position: absolute; top: -2px; right: -5px; background-color: var(--color-danger); color: var(--color-white); border-radius: 50%; width: 20px; height: 20px; font-size: 0.7rem; font-weight: 700; display: none; place-items: center; line-height: 1; }
        #cart-badge.visible { display: grid; }
        
        .desktop-nav { display: flex; align-items: center; gap: 30px; }
        .desktop-nav a { text-decoration: none; color: var(--text-secondary); font-weight: 500; font-size: 1rem; transition: color var(--transition); }
        .desktop-nav a:hover, .desktop-nav a.active { color: var(--primary-color); }
        
        .main-controls { display: flex; justify-content: space-between; align-items: center; padding-top: 20px; gap: 20px; flex-wrap: wrap; }
        .view-toggle-buttons .icon-btn { border-radius: var(--radius-small); padding: 8px 12px; }
        .view-toggle-buttons .icon-btn.active { background: var(--primary-color); color: var(--color-white); }
        
        .category-nav-wrapper { position: sticky; top: 73px; z-index: 999; background: var(--bg-body); transition: background-color var(--transition), box-shadow var(--transition); border-bottom: 1px solid transparent; overflow: hidden; }
        .category-nav-wrapper.sticky { box-shadow: var(--shadow-soft); border-bottom-color: var(--border-color); }
        .category-nav { display: flex; overflow-x: auto; white-space: nowrap; padding: 20px 24px; margin: 0 -24px; -ms-overflow-style: none; scrollbar-width: none; }
        .category-nav::-webkit-scrollbar { display: none; }
        .category-nav .filter-btn { flex: 0 0 auto; background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-pill); padding: 10px 28px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all var(--transition); margin-right: 12px; color: var(--text-primary); }
        .category-nav .filter-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-soft); border-color: var(--primary-color); }
        .category-nav .filter-btn.active { background: var(--gradient-primary); color: var(--color-white); border-color: transparent; box-shadow: var(--shadow-strong); transform: translateY(-2px) scale(1.03); }
        .category-nav .filter-btn .fav-count { background-color: rgba(255, 255, 255, 0.2); color: var(--color-white); border-radius: 50%; font-size: 0.7rem; padding: 2px 6px; margin-left: 8px; font-weight: 700; }
        
        /* ---- Product Grid & Card ---- */
        .product-grid { display: grid; gap: 30px; padding-top: 20px; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
        .product-card { background-color: var(--bg-card); border-radius: var(--radius-medium); box-shadow: var(--shadow-soft); overflow: hidden; display: flex; flex-direction: column; transition: all var(--transition); border: 1px solid var(--border-color); opacity: 0; transform: translateY(20px); animation: fadeInEntry 0.5s ease-out forwards; }
        @keyframes fadeInEntry { to { opacity: 1; transform: translateY(0); } }
        .product-card.hidden { display: none; }
        .product-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-medium); }
        
        .product-grid.list-view { grid-template-columns: 1fr; }
        .product-grid.list-view .product-card { flex-direction: row; align-items: center; }
        .product-grid.list-view .product-image { height: 180px; width: 250px; flex-shrink: 0; }
        .product-grid.list-view .product-content { padding-top: 0; flex-grow: 1;}
        .product-grid.list-view .card-footer { display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
        .product-grid.list-view .add-to-cart-btn { width: auto; flex-grow: 1; }

        .product-image { width: 100%; height: 250px; background-color: var(--bg-image); padding: 1rem; display: flex; align-items: center; justify-content: center; position: relative; transition: background-color var(--transition); }
        .product-image img { max-width: 100%; max-height: 100%; width: auto; height: auto; object-fit: contain; transition: transform 0.4s ease; cursor: zoom-in; }
        .product-card:hover .product-image img { transform: scale(1.05); }

        .fav-btn { position: absolute; top: 15px; right: 15px; font-size: 1.5rem; color: var(--color-white); background: rgba(0, 0, 0, 0.4); backdrop-filter: blur(5px); width: 44px; height: 44px; border-radius: 50%; display: grid; place-items: center; cursor: pointer; transition: all 0.2s; z-index: 10; }
        .fav-btn:hover { background: rgba(0,0,0,0.6); transform: scale(1.1); }
        .fav-btn.favorited { color: var(--color-danger); background: rgba(255,255,255,0.4); }
        
        .product-content { padding: 24px; flex-grow: 1; display: flex; flex-direction: column; width: 100%; }
        .product-card h3 { font-size: 1.4rem; font-weight: 600; color: var(--primary-color); margin-bottom: 1rem; line-height: 1.3; }
        .product-options { display: grid; gap: 1rem; margin-bottom: 1.5rem; }
        .option-group { display: flex; flex-direction: column; gap: 8px; position: relative; }
        .option-group label { font-weight: 500; color: var(--text-secondary); font-size: 0.9rem; }
        .option-group input, .option-group select, .size-inputs { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: var(--radius-small); background-color: var(--bg-input); color: var(--text-primary); font-size: 1rem; transition: all var(--transition); }
        .option-group input:focus, .option-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 4px hsla(217, 98%, 52%, 0.2); }
        .size-inputs { display: flex; gap: 10px; padding: 0; border: none; background: none; }
        
        .card-footer { margin-top: auto; padding-top: 1rem; }
        
        .add-to-cart-btn { background: var(--gradient-accent); color: #111; border: none; padding: 16px; width: 100%; border-radius: var(--radius-medium); font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all var(--transition); box-shadow: 0 4px 15px hsla(43, 98%, 58%, 0.3); }
        .add-to-cart-btn:hover:not(:disabled) { transform: scale(1.03); box-shadow: 0 6px 20px hsla(43, 98%, 58%, 0.5); }
        .add-to-cart-btn:disabled { background: var(--border-color); color: var(--text-secondary); cursor: not-allowed; box-shadow: none; }

        /* ---- Skeleton Loader ---- */
        .skeleton-card { background-color: var(--bg-card); border-radius: var(--radius-medium); padding: 20px; border: 1px solid var(--border-color); }
        .skeleton-image, .skeleton-text { background-color: var(--bg-input); background: linear-gradient(100deg, var(--bg-input) 8%, var(--bg-image) 18%, var(--bg-input) 33%); background-size: 200% 100%; animation: shimmer 1.5s linear infinite; }
        @keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }
        .skeleton-image { height: 230px; border-radius: var(--radius-small); }
        .skeleton-text { height: 24px; border-radius: 4px; margin-top: 24px; }
        .skeleton-text.short { width: 60%; margin-top: 12px; }

        /* ---- Overlays & Modals ---- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 32, 44, 0.7); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; animation: fadeIn 0.3s ease; }
        .modal-overlay.visible { display: flex; }
        .modal-content { background: var(--bg-card); border-radius: var(--radius-medium); box-shadow: var(--shadow-medium); max-width: 90vw; max-height: 90vh; overflow-y: auto; animation: zoomIn 0.3s cubic-bezier(0.25, 1, 0.5, 1); position: relative; padding: 2rem; width: 100%; max-width: 500px; }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: var(--bg-input); border: none; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: grid; place-items: center; z-index: 10; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        #toast-container { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); z-index: 3000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background-color: rgba(29, 37, 51, 0.9); color: var(--color-white); padding: 14px 24px; border-radius: var(--radius-pill); font-size: 0.9rem; font-weight: 500; box-shadow: var(--shadow-medium); backdrop-filter: blur(5px); animation: toast-in 0.5s cubic-bezier(0.25, 1, 0.5, 1); }
        .toast.success { background: var(--color-success); } .toast.error { background: var(--color-danger); }
        @keyframes toast-in { from { opacity: 0; transform: translateY(20px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        #image-zoom-modal .zoomed-image-content { max-width: 90vw; max-height: 85vh; object-fit: contain; padding: 0; }
        
        /* Shopping Cart Panel CSS */
        #cart-panel { position: fixed; top: 0; right: 0; width: 100%; max-width: 450px; height: 100%; background: var(--bg-card); z-index: 2500; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1); display: flex; flex-direction: column; border-left: 1px solid var(--border-color); }
        #cart-panel.visible { transform: translateX(0); box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
        .cart-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        .cart-header h2 { font-size: 1.5rem; }
        .cart-items { flex-grow: 1; overflow-y: auto; padding: 1rem; }
        .cart-item { display: flex; gap: 1rem; margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; align-items: center; }
        .cart-item img { width: 80px; height: 80px; object-fit: cover; border-radius: var(--radius-small); flex-shrink: 0; }
        .cart-item-details { flex-grow: 1; display: flex; flex-direction: column; gap: 0.25rem; }
        .cart-item-details .item-name { font-weight: 600; }
        .cart-item-details .item-options { font-size: 0.8rem; color: var(--text-secondary); }
        .cart-item-actions { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; }
        .cart-item-actions .quantity-input { width: 50px; text-align: center; }
        .cart-item-actions .remove-item-btn { background: none; border: none; color: var(--color-danger); cursor: pointer; font-size: 1.2rem; }
        .cart-footer { padding: 20px; border-top: 1px solid var(--border-color); background: var(--bg-input); flex-shrink: 0;}
        
        /* Settings Modal CSS */
        .settings-group { margin-bottom: 2rem; }
        .settings-group h3 { margin-bottom: 1rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
        .theme-options, .lang-options { display: flex; flex-wrap: wrap; gap: 1rem; }
        .theme-options label, .lang-options label { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .theme-swatch { width: 50px; height: 50px; border-radius: 50%; border: 3px solid var(--border-color); margin-bottom: 0.5rem; }
        .theme-options input:checked + .theme-swatch { border-color: var(--primary-color); }
        .theme-swatch.light { background: #f8f9fa; } .theme-swatch.dark { background: #1a202c; } .theme-swatch.sepia { background: #f1e7d0; }
        #font-size-slider { width: 100%; }
        #font-size-value { font-weight: 600; color: var(--primary-color); }

        /* ---- Floating & Mobile Elements ---- */
        #back-to-top { position: fixed; bottom: 25px; right: 25px; background: var(--primary-color); color: var(--color-white); width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer; display: none; place-items: center; z-index: 1002; font-size: 1.25rem; opacity: 0; transform: scale(0.8); transition: opacity 0.3s, transform 0.3s; box-shadow: var(--shadow-medium); }
        #back-to-top.visible { opacity: 1; transform: scale(1); }
        .mobile-bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background-color: var(--bg-overlay); backdrop-filter: saturate(180%) blur(10px); display: none; justify-content: space-around; padding: 10px 0 15px; border-top: 1px solid var(--border-color); z-index: 1001; }
        .mobile-bottom-nav a.active { color: var(--primary-color); }
        .mobile-bottom-nav .hidden { display: none; }
        
        /* ---- Custom Card Styles ---- */
        .product-card-facebook { background: linear-gradient(45deg, #00c6ff, #0072ff); padding: 24px; color: var(--color-white); }
        .product-card-facebook:hover { box-shadow: 0 20px 25px -5px rgba(0, 114, 255, 0.3), 0 8px 10px -6px rgba(0, 114, 255, 0.3); }
        .product-card-facebook h3 { color: var(--color-white); font-size: 1.8rem; margin-bottom: 0.5rem; }
        .product-card-facebook .description { font-size: 1.1rem; font-style: italic; opacity: 0.9; margin-bottom: 1.5rem; }
        .product-card-facebook .image-previews { display: flex; justify-content: center; gap: 12px; margin-bottom: 1.5rem; align-items: center; }
        .product-card-facebook .image-previews img { max-width: 200px; border-radius: var(--radius-small); box-shadow: var(--shadow-medium); cursor: zoom-in; transition: transform 0.3s ease; }
        .product-card-facebook .image-previews img:hover { transform: scale(1.08); }
        .product-card-facebook .rating-container { display: flex; align-items: center; gap: 0px; font-size: 0rem; font-weight: 0; margin-bottom: rem; }
        .product-card-facebook .rating-container .stars { color: #ffffff; }
        .product-card-facebook .stars .fa-star-half-alt, .product-card-facebook .stars .fa-star.empty { color: rgba(255, 255, 255, 0.5); }
        .product-card-facebook .custom-footer { margin-top: auto; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(5px); border-radius: var(--radius-pill); padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; }
          .product-card-facebook .price { font-weight: 700; font-size: 1rem; background-color: var(--color-white); color: var(--primary-color); padding: 5px 15px; border-radius: var(--radius-pill); }
        .product-card-facebook .buy-btn { background-color: var(--primary-color); color: var(--color-white); border: none; padding: 5px 20px; border-radius: var(--radius-pill); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all var(--transition); text-decoration: none; display: inline-block; }
        .product-card-facebook .buy-btn:hover { background-color: #0b5ed7; }
        .product-card-facebook .seller-name { font-weight: 00; font-size: 0rem; }
      
        /* ---- Generic Service Card Styles (for Rent, Bus, Courier) ---- */
        .service-details { margin: 1rem 0; display: flex; flex-direction: column; gap: 0.75rem; }
        .service-info { font-size: 0.95rem; display: flex; align-items: center; gap: 10px; color: var(--text-secondary); }
        .service-info i { color: var(--primary-color); width: 20px; text-align: center; }
        .service-price-info { font-size: 0.95rem; display: flex; align-items: center; gap: 10px; }
        .service-price-info i { color: var(--primary-color); width: 20px; text-align: center; }
        .service-price-info strong { color: var(--color-success); font-weight: 600; font-size: 1.1rem; }
        
        /* Custom "Contact" button */
        .whatsapp-buy-btn { background: var(--gradient-accent); color: #111; border: none; padding: 16px; width: 100%; border-radius: var(--radius-medium); font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all var(--transition); box-shadow: 0 4px 15px hsla(43, 98%, 58%, 0.3); display: flex; align-items: center; justify-content: center; gap: 8px; text-decoration: none; }
        .whatsapp-buy-btn:hover { transform: scale(1.03); box-shadow: 0 6px 20px hsla(43, 98%, 58%, 0.5); }

        /* ---- Responsive Design ---- */
        @media (max-width: 991px) { .desktop-nav { display: none; } .mobile-bottom-nav { display: flex; } #back-to-top { bottom: 90px; } }
        @media (max-width: 767px) {
            html { font-size: 15px; } .container { padding: 0 16px; } .header-content { flex-wrap: wrap; } .logo-area .shop-name { font-size: 1.4rem; } .search-bar-wrapper { width: 100%; order: 3; margin-top: 15px; } .category-nav-wrapper { top: 125px; } .category-nav { padding: 16px; margin: 0 -16px; } .category-nav .filter-btn { padding: 8px 20px; font-size: 0.9rem; }
            .product-grid:not(.list-view) { grid-template-columns: repeat(2, 1fr); gap: 16px; } .product-grid:not(.list-view) .product-image { height: 160px; } .product-grid:not(.list-view) .product-card h3 { font-size: 1.1rem; margin-bottom: 0.75rem; } .product-grid:not(.list-view) .product-content { padding: 12px; } .product-grid:not(.list-view) .add-to-cart-btn, .product-grid:not(.list-view) .whatsapp-buy-btn { padding: 12px; font-size: 1rem; } .product-grid:not(.list-view) .option-group label { font-size: 0.85rem; } .product-grid:not(.list-view) .option-group input, .product-grid:not(.list-view) .option-group select { padding: 10px; font-size: 0.9rem; }
            .product-grid.list-view .product-card { flex-direction: column; align-items: flex-start; } .product-grid.list-view .product-image { width: 100%; height: 220px; }
        }
        .wa-popup { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background-color: #25D366; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; z-index: 9999; }
        .wa-popup svg { width: 32px; height: 32px; fill: white; } .wa-popup.show { opacity: 1; pointer-events: auto; animation: bounce 1.5s ease infinite; } @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
</head>
<body data-theme="light">
    
    <!-- WhatsApp Popup -->
    <div id="waPopup" class="wa-popup" title="Join WhatsApp Group"></div>

    <!-- Header -->
    <header class="main-header">
         <div class="container header-content">
            <div class="logo-area"><h1 class="shop-name">RubiXtha Official </h1><h3>Gajuri-1,Dhading</h3></div>
            <div class="search-bar-wrapper">
                <input type="search" id="search-input" placeholder="Search products...">
                <i class="fa-solid fa-xmark" id="clear-search-btn"></i>
            </div>
            <div class="header-actions">
                <nav class="desktop-nav"><a href="#" id="desktop-home-btn" class="active" data-i18n-key="nav.home">Home</a><a href="#" id="desktop-fav-btn" data-i18n-key="nav.favorites">Favorites</a><a href="https://bishal17577.github.io/chhapakhana-bill/" data-i18n-key="Bill">BIll</a>   <a href="https://bishal17577.github.io/RUBI-STORE/">Girl</a></nav>
                <button class="header-icon-btn" id="settings-btn" aria-label="Open Settings"><i class="fa-solid fa-gear"></i></button>
                <button class="header-icon-btn" id="cart-toggle-btn" aria-label="Open Cart">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span id="cart-badge">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Controls -->
    <div class="container main-controls">
        <div class="category-nav-wrapper">
            <nav class="category-nav" id="category-nav"></nav>
        </div>
        <div class="view-toggle-buttons">
            <button class="icon-btn active" id="grid-view-btn" data-view="grid"><i class="fa-solid fa-grip"></i></button>
            <button class="icon-btn" id="list-view-btn" data-view="list"><i class="fa-solid fa-list"></i></button>
        </div>
    </div>
    
    <!-- Main Content -->
    <main class="container">
        <p id="product-count" style="margin-top: 1rem; color: var(--text-secondary);"></p>
        <section class="product-grid loading" id="product-grid">
            <div class="skeleton-card"><div class="skeleton-image"></div><div class="skeleton-text"></div><div class="skeleton-text short"></div></div>
            <div class="skeleton-card"><div class="skeleton-image"></div><div class="skeleton-text"></div><div class="skeleton-text short"></div></div>
            <div class="skeleton-card"><div class="skeleton-image"></div><div class="skeleton-text"></div><div class="skeleton-text short"></div></div>
            <div class="skeleton-card"><div class="skeleton-image"></div><div class="skeleton-text"></div><div class="skeleton-text short"></div></div>
        </section>
    </main>

    <!-- Mobile Navigation -->
    <nav class="mobile-bottom-nav">
        <a href="#" id="mobile-home-btn" class="active">
          <i class="fas fa-home"></i> 
          <span data-i18n-key="nav.home">Home</span>
        </a>
        <a href="#" id="mobile-fav-btn" class="hidden">
          <i class="fas fa-heart"></i> 
          <span data-i18n-key="nav.favorites">Favorites</span>
        </a>
        <a href="https://chat.whatsapp.com/CGk4PDkKpGsCIftYHv5hhq">
          <i class="fab fa-whatsapp"></i> RX XTHA
        </a>
    </nav>
      
    <!-- Modals -->
    <div id="image-zoom-modal" class="modal-overlay"><img id="zoomed-image-src" class="zoomed-image-content"></div>
    <div id="settings-modal" class="modal-overlay"><div class="modal-content" id="settings-modal-content"></div></div>
    
    <!-- Cart Side Panel -->
    <aside id="cart-panel">
        <div class="cart-header">
            <h2 data-i18n-key="cart.title">Your Cart</h2>
            <button class="modal-close-btn" id="cart-close-btn">×</button>
        </div>
        <div class="cart-items" id="cart-items-container">
            <p id="cart-empty-msg" data-i18n-key="cart.empty">Your cart is empty.</p>
        </div>
        <div class="cart-footer">
            <button id="checkout-btn" class="add-to-cart-btn" disabled data-i18n-key="cart.checkout">Checkout to WhatsApp</button>
        </div>
    </aside>

    <!-- Global Elements -->
    <div id="toast-container"></div>
    <button id="back-to-top" title="Go to top"><i class="fas fa-arrow-up"></i></button>
<!-- Popup HTML -->
<div class="popup-bg" id="popupAd">
    <div class="popup-box">
      <span class="close-btn" onclick="closePopup()">×</span>
      <img src="https://i.ibb.co/rfNcQJQM/New-Project.jpg" alt="Popup Ad">
    </div>
</div>
  
<script>
"use strict";

// ===== TRANSLATION & UTILITY HELPERS =====
const toNepaliNumerals = (str) => {
    if (typeof str !== 'string' && typeof str !== 'number') return str;
    const nepaliDigits = ['०', '१', '२', '३', '४', '५', '६', '७', '८', '९'];
    return String(str).replace(/[0-9.]/g, digit => digit === '.' ? '.' : nepaliDigits[digit]);
};

const getText = (field) => {
    if (typeof field === 'object' && field !== null) {
        return field[I18n.currentLang] || field['en'];
    }
    return field;
};

const MockAPI = {
    fetchProducts: () => new Promise(resolve => {
        setTimeout(() => {
            resolve([
            // ===== BILINGUAL DATA SOURCE =====
            // --- BUS RENT & COURIER ---
            {
                "id": "best-bus", "name": { "en": "BEST BUS", "ne": "BEST BUS" }, "category": "bus-rent", "isCustom": true, "imageSrc": "https://i.ibb.co/dqw9v6H/1.jpg",
                "data": { "busName": { "en": "Kathmandu-Dhading-Aarughat", "ne": "BEST BUS" }, "busNumber": { "en": "Ba 6 Kha 5941", "ne": "Ba 6 Kha 5941" }, "seller": { "en": "Gajuri Travel & Tours", "ne": "गजुरी ट्राभल एण्ड टुर्स" }, "whatsappNumber": "9761614027" }
            },

           /*{
                "id": "courier-gajuri-ktm-1", "name": { "en": "Gajuri to Ktm Courier Service", "ne": "गजुरी देखि काठमाडौं कुरियर सेवा" }, "category": "courier", "isCustom": true, "imageSrc": "https://i.ibb.co/L5B1B7b/local-bus.jpg",
                "data": { "ownerName": { "en": "Ram Kumar Shrestha", "ne": "राम कुमार श्रेष्ठ" }, "busNumber": { "en": "Ba 5 Kha 5941", "ne": "ना ५ ख ५६७८" }, "route": { "en": "Gajuri - Kalanki, Kathmandu", "ne": "गजुरी - कलंकी, काठमाडौं" }, "whatsappNumber": "9845098765" }
            },*/





/*

            // --- ROOM RENT ---
            {
                "id": "room-gajuri-1", "name": { "en": "Single Room for Rent in Gajuri", "ne": "गजुरीमा एकल कोठा भाडामा" }, "category": "room-rent", "isCustom": true, "imageSrc": "https://i.ibb.co/6yYQ1sR/room1.jpg",
                "data": { "seller": { "en": "Sita Thapa", "ne": "सीता थापा" }, "address": { "en": "Gajuri Bazaar, Near Highway", "ne": "गजुरी बजार, राजमार्ग नजिक" }, "price": { "en": "Rs. 5,500 / month", "ne": "रु. ५,५०० / महिना" }, "whatsappNumber": "9812345670" }
            },
            {
                "id": "room-gajuri-2", "name": { "en": "2-Room Flat Available", "ne": "२ कोठे फ्ल्याट उपलब्ध छ" }, "category": "room-rent", "isCustom": true, "imageSrc": "https://i.ibb.co/Yd4GfD9/room2.jpg",
                "data": { "seller": { "en": "Hari Bahadur", "ne": "हरि बहादुर" }, "address": { "en": "Gajuri-1, Prithvi Highway", "ne": "गजुरी-१, पृथ्वी राजमार्ग" }, "price": { "en": "Rs. 8,000 / month", "ne": "रु. ८,००० / महिना" }, "whatsappNumber": "9809876543" }
            },
            // --- CLOTHES ---
            { 
                "id": "kurta-set-1", "name": { "en": "Elegant Cotton Kurta Set", "ne": "सुन्दर सुती कुर्ता सेट" }, "category": "clothes", "imageSrc": "https://i.ibb.co/jLwhpCh/kurta1.jpg", 
                "options": [ { "name": "Size", "label": { "en": "Select Size", "ne": "साइज छान्नुहोस्" }, "type": "select", "values": [{ "en": "Small", "ne": "सानो" }, { "en": "Medium", "ne": "मध्यम" }, { "en": "Large", "ne": "ठूलो" }, { "en": "XL", "ne": "एक्सएल" }] }, { "name": "Quantity", "label": { "en": "Quantity", "ne": "मात्रा" }, "type": "number", "attributes": { "value": "1", "min": "1" }} ]
            },
            { 
                "id": "saree-1", "name": { "en": "Traditional Silk Saree", "ne": "पारम्परिक सिल्क साडी" }, "category": "clothes", "imageSrc": "https://i.ibb.co/xGLgMv5/saree1.jpg", 
                "options": [ { "name": "Color", "label": { "en": "Color", "ne": "रंग" }, "type": "select", "values": [{ "en": "Red", "ne": "रातो" }, { "en": "Blue", "ne": "निलो" }, { "en": "Green", "ne": "हरियो" }] }, { "name": "Quantity", "label": { "en": "Quantity", "ne": "मात्रा" }, "type": "number", "attributes": { "value": "1", "min": "1" }} ]
            },*/









            // --- GADGETS ---
            { 
                "id": "gadget-arduino", "name": { "en": "Aurdino UNO", "ne": "अर्डिनो युनो" }, "category": "gadgets", "isCustom": true,
                "data": { "description": { "en": "Best Product On Sales. Limited Stock.", "ne": "बिक्रीमा उत्कृष्ट उत्पादन। सीमित स्टक।" }, "previewImages": [ "https://i.ibb.co/n8r9Syw8/1.jpg" ], "rating": 4.6, "seller": { "en": "RX SAJILO", "ne": "आरएक्स सजिलो" }, "price": "1100", "whatsappNumber": "9761614027" }
            },
            { 
                "id": "gadget-esp8266", "name": { "en": "ESP-8266", "ne": "ईएसपी-८२६६" }, "category": "gadgets", "isCustom": true,
                "data": { "description": { "en": "Best Product On Sales. Limited Stock.", "ne": "बिक्रीमा उत्कृष्ट उत्पादन। सीमित स्टक।" }, "previewImages": [ "https://i.ibb.co/5g2QFpnR/2.jpg" ], "rating": 3, "seller": { "en": "RX SAJILO", "ne": "आरएक्स सजिलो" }, "price": "900", "whatsappNumber": "9761614027" }
            },
            // --- PRINTING SERVICES ---
            { "id": "happy-birthday-new-1", "name": { "en": "Birthday Celebration Banner", "ne": "जन्मदिन समारोह ब्यानर" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/jvHj4VWP/fc40ab918e0bd83eaafebc1c8d4acebd.jpg", "options": [] },
            { "id": "happy-birthday-new-2", "name": { "en": "Custom Birthday Poster", "ne": "अनुकूलित जन्मदिन पोस्टर" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/VWhf0K9V/f24753a8116df2d61314731aa5f66872.jpg", "options": [] },
            { "id": "jersey-print-1", "name": { "en": "Jersey print 1", "ne": "जर्सी प्रिन्ट १" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/99M3bXpg/images.jpg", "options": [] },
            { "id": "business-card-2", "name": { "en": "Business Card 2", "ne": "बिजनेस कार्ड २" }, "category": "business-card", "imageSrc": "https://i.ibb.co/G4NH6W67/temp-Image-Bh-VUQZ.jpg", "options": []},
            { "id": "happy-birthday-3", "name": { "en": "happy birthday 3", "ne": "जन्मदिनको शुभकामना ३" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/L3MsCnN/b542c45122d0796c7ec5da8a59e09b53.jpg", "options": [] },
            { "id": "business-card-4", "name": { "en": "Business Card 4", "ne": "बिजनेस कार्ड ४" }, "category": "business-card", "imageSrc": "https://i.ibb.co/nsR0DLNV/1.jpg", "options": []},
            { "id": "business-card-5", "name": { "en": "Business Card 5", "ne": "बिजनेस कार्ड ५" }, "category": "business-card", "imageSrc": "https://i.ibb.co/2YSkGQn6/2.jpg", "options": []},
            { "id": "business-card-6", "name": { "en": "Business Card 6", "ne": "बिजनेस कार्ड ६" }, "category": "business-card", "imageSrc": "https://i.ibb.co/k2HRRMBc/3.jpg", "options": []},
            { "id": "business-card-7", "name": { "en": "Business Card 7", "ne": "बिजनेस कार्ड ७" }, "category": "business-card", "imageSrc": "https://i.ibb.co/7JnLxFSJ/4.jpg", "options": []},
            { "id": "business-card-8", "name": { "en": "Business Card 8", "ne": "बिजनेस कार्ड ८" }, "category": "business-card", "imageSrc": "https://i.ibb.co/84jzdLHn/5.jpg", "options": []},
            { "id": "business-card-9", "name": { "en": "Business Card 9", "ne": "बिजनेस कार्ड ९" }, "category": "business-card", "imageSrc": "https://i.ibb.co/qF9GL0Zr/6.jpg", "options": []},
            { "id": "business-card-10", "name": { "en": "Business Card 10", "ne": "बिजनेस कार्ड १०" }, "category": "business-card", "imageSrc": "https://i.ibb.co/jP5M4rp4/7.jpg", "options": []},
            { "id": "business-card-11", "name": { "en": "Business Card 11", "ne": "बिजनेस कार्ड ११" }, "category": "business-card", "imageSrc": "https://i.ibb.co/p66FXRh8/8.jpg", "options": []},
            { "id": "business-card-12", "name": { "en": "Business Card 12", "ne": "बिजनेस कार्ड १२" }, "category": "business-card", "imageSrc": "https://i.ibb.co/d0fNtVWm/9.jpg", "options": []},
            { "id": "business-card-13", "name": { "en": "Business Card 13", "ne": "बिजनेस कार्ड १३" }, "category": "business-card", "imageSrc": "https://i.ibb.co/JR5DpL3y/10.jpg", "options": []},
            { "id": "business-card-14", "name": { "en": "Business Card 14", "ne": "बिजनेस कार्ड १४" }, "category": "business-card", "imageSrc": "https://i.ibb.co/wNSPtwKX/11.jpg", "options": []},
            { "id": "business-card-15", "name": { "en": "Business Card 15", "ne": "बिजनेस कार्ड १५" }, "category": "business-card", "imageSrc": "https://i.ibb.co/5XDmsZ2J/12.jpg", "options": []},
            { "id": "business-card-16", "name": { "en": "Business Card 16", "ne": "बिजनेस कार्ड १६" }, "category": "business-card", "imageSrc": "https://i.ibb.co/DgDVS5Ng/13.jpg", "options": []},
            { "id": "business-card-17", "name": { "en": "Business Card 17", "ne": "बिजनेस कार्ड १७" }, "category": "business-card", "imageSrc": "https://i.ibb.co/Y7r6ZPRk/15.jpg", "options": []},
            { "id": "business-card-18", "name": { "en": "Business Card 18", "ne": "बिजनेस कार्ड १८" }, "category": "business-card", "imageSrc": "https://i.ibb.co/sf36sDd/16.jpg", "options": []},
            { "id": "business-card-19", "name": { "en": "Business Card 19", "ne": "बिजनेस कार्ड १९" }, "category": "business-card", "imageSrc": "https://i.ibb.co/0jrFxChp/17.jpg", "options": []},
            { "id": "business-card-20", "name": { "en": "Business Card 20", "ne": "बिजनेस कार्ड २०" }, "category": "business-card", "imageSrc": "https://i.ibb.co/50vHyG5/18.jpg", "options": []},
            { "id": "business-card-21", "name": { "en": "Business Card 21", "ne": "बिजनेस कार्ड २१" }, "category": "business-card", "imageSrc": "https://i.ibb.co/7tsNYXmp/19.jpg", "options": []},
            { "id": "business-card-22", "name": { "en": "Business Card 22", "ne": "बिजनेस कार्ड २२" }, "category": "business-card", "imageSrc": "https://i.ibb.co/4RrVVVhm/20.jpg", "options": []},
            { "id": "business-card-23", "name": { "en": "Business Card 23", "ne": "बिजनेस कार्ड २३" }, "category": "business-card", "imageSrc": "https://i.ibb.co/b5VNJncP/21.jpg", "options": []},
            { "id": "business-card-24", "name": { "en": "Business Card 24", "ne": "बिजनेस कार्ड २४" }, "category": "business-card", "imageSrc": "https://i.ibb.co/xKhQXYzq/22.jpg", "options": []},
            { "id": "business-card-25", "name": { "en": "Business Card 25", "ne": "बिजनेस कार्ड २५" }, "category": "business-card", "imageSrc": "https://i.ibb.co/84LFQQx5/23.jpg", "options": []},
            { "id": "business-card-26", "name": { "en": "Business Card 26", "ne": "बिजनेस कार्ड २६" }, "category": "business-card", "imageSrc": "https://i.ibb.co/G4Vkv4zv/24.jpg", "options": []},
            { "id": "business-card-27", "name": { "en": "Business Card 27", "ne": "बिजनेस कार्ड २७" }, "category": "business-card", "imageSrc": "https://i.ibb.co/qK4xLYs/25.jpg", "options": []},
            { "id": "business-card-28", "name": { "en": "Business Card 28", "ne": "बिजनेस कार्ड २८" }, "category": "business-card", "imageSrc": "https://i.ibb.co/sLmkPx5/26.jpg", "options": []},
            { "id": "business-card-29", "name": { "en": "Business Card 29", "ne": "बिजनेस कार्ड २९" }, "category": "business-card", "imageSrc": "https://i.ibb.co/nNVC8pDc/27.jpg", "options": []},
            { "id": "business-card-30", "name": { "en": "Business Card 30", "ne": "बिजनेस कार्ड ३०" }, "category": "business-card", "imageSrc": "https://i.ibb.co/wZ97TRLz/28.jpg", "options": []},
            { "id": "business-card-31", "name": { "en": "Business Card 31", "ne": "बिजनेस कार्ड ३१" }, "category": "business-card", "imageSrc": "https://i.ibb.co/4nTdrx3L/29.jpg", "options": []},
            { "id": "business-card-32", "name": { "en": "Business Card 32", "ne": "बिजनेस कार्ड ३२" }, "category": "business-card", "imageSrc": "https://i.ibb.co/Rk2vVf1H/30.jpg", "options": []},
            { "id": "business-card-33", "name": { "en": "Business Card 33", "ne": "बिजनेस कार्ड ३३" }, "category": "business-card", "imageSrc": "https://i.ibb.co/b59RtGRs/32.jpg", "options": []},
            { "id": "business-card-34", "name": { "en": "Business Card 34", "ne": "बिजनेस कार्ड ३४" }, "category": "business-card", "imageSrc": "https://i.ibb.co/zTq6cP0Y/33.jpg", "options": []},
            { "id": "business-card-35", "name": { "en": "Business Card 35", "ne": "बिजनेस कार्ड ३५" }, "category": "business-card", "imageSrc": "https://i.ibb.co/8gwfHSLS/34.jpg", "options": []},
            { "id": "business-card-36", "name": { "en": "Business Card 36", "ne": "बिजनेस कार्ड ३६" }, "category": "business-card", "imageSrc": "https://i.ibb.co/Qv0DN3J7/35.jpg", "options": []},
            { "id": "business-card-37", "name": { "en": "Business Card 37", "ne": "बिजनेस कार्ड ३७" }, "category": "business-card", "imageSrc": "https://i.ibb.co/B5jSGwfL/36.jpg", "options": []},
            { "id": "cup-print-38", "name": { "en": "CUP PRINT 38", "ne": "कप प्रिन्ट ३८" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/G3VyKFJV/1.jpg", "options": [] },
            { "id": "happy-birthday-78", "name": { "en": "happy birthday 78", "ne": "जन्मदिनको शुभकामना ७८" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/d0csbXSY/68c1575b1d0a1d982ab33b38bc83be77.jpg", "options": [] },
            { "id": "happy-birthday-79", "name": { "en": "happy birthday 79", "ne": "जन्मदिनको शुभकामना ७९" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/4nMFgJf7/090c080a837d32af879b2c296deff321.jpg", "options": [] },
            { "id": "happy-birthday-80", "name": { "en": "happy birthday 80", "ne": "जन्मदिनको शुभकामना ८०" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/PsT5BYR6/97f42eea8a3ee94b45a1e7a8d6a38984.jpg", "options": [] },
            { "id": "happy-birthday-81", "name": { "en": "happy birthday 81", "ne": "जन्मदिनको शुभकामना ८१" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/mrj89mvX/681e718f0e253e7ece72f85a65c7e19e.jpg", "options": [] },
            { "id": "happy-birthday-82", "name": { "en": "happy birthday 82", "ne": "जन्मदिनको शुभकामना ८२" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/Y4GzxFY1/1534aa064b4d0b7dfeed742581d67a4c.jpg", "options": [] },
            { "id": "happy-birthday-83", "name": { "en": "happy birthday 83", "ne": "जन्मदिनको शुभकामना ८३" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/6cxjXc1f/48893f4670c403e470203d75dc11d756.jpg", "options": [] },
            { "id": "happy-birthday-84", "name": { "en": "happy birthday 84", "ne": "जन्मदिनको शुभकामना ८४" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/gb4bPFd0/378155ab7bded385d5dd01d4f27bb0fb.jpg", "options": [] },
            { "id": "happy-birthday-85", "name": { "en": "happy birthday 85", "ne": "जन्मदिनको शुभकामना ८५" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/spBfPF4F/439917e27caf25638895edf0456c13e2.jpg", "options": [] },
            { "id": "happy-birthday-86", "name": { "en": "happy birthday 86", "ne": "जन्मदिनको शुभकामना ८६" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/jk1wyh8D/0807122adb235c7aac8ed9ab1cebfbd0.jpg", "options": [] },
            { "id": "happy-birthday-87", "name": { "en": "happy birthday 87", "ne": "जन्मदिनको शुभकामना ८७" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/C3S9pWGG/71524635fad55d2ec9546e04bb6ff5d4.jpg", "options": [] },
            { "id": "happy-birthday-88", "name": { "en": "happy birthday 88", "ne": "जन्मदिनको शुभकामना ८८" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/Y7cxYR14/064388352622b119f4b9c40af90bd21d.jpg", "options": [] },
            { "id": "happy-birthday-89", "name": { "en": "happy birthday 89", "ne": "जन्मदिनको शुभकामना ८९" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/MxLY2yGm/a4aed2e8cf8023349bc15887ac62b029.jpg", "options": [] },
            { "id": "happy-birthday-90", "name": { "en": "happy birthday 90", "ne": "जन्मदिनको शुभकामना ९०" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/Wv00p6Cm/a63e62ba1b498e40294005bc5504f0d3.jpg", "options": [] },
            { "id": "happy-birthday-91", "name": { "en": "happy birthday 91", "ne": "जन्मदिनको शुभकामना ९१" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/NgcM8g7j/b53eb72a1003b6dd799b11305adbe661.jpg", "options": [] },
            { "id": "happy-birthday-92", "name": { "en": "happy birthday 92", "ne": "जन्मदिनको शुभकामना ९२" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/L3MsCnN/b542c45122d0796c7ec5da8a59e09b53.jpg", "options": [] },
            { "id": "happy-birthday-93", "name": { "en": "happy birthday 93", "ne": "जन्मदिनको शुभकामना ९३" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/Fkm0fY54/c295e348e64a2ece7ae17a14d1728eac.jpg", "options": [] },
            { "id": "happy-birthday-94", "name": { "en": "happy birthday 94", "ne": "जन्मदिनको शुभकामना ९४" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/tTrB6H1B/d7fdc05f8f6290302f15c4cd1909bc34.jpg", "options": [] },
            { "id": "happy-birthday-95", "name": { "en": "happy birthday 95", "ne": "जन्मदिनको शुभकामना ९५" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/8nj51y0h/db58e102a1616f801f0d40bb35668920.jpg", "options": [] },
            { "id": "happy-birthday-96", "name": { "en": "happy birthday 96", "ne": "जन्मदिनको शुभकामना ९६" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/M4ftLMd/e0c74c56588763e505a6d6ced00b74d9.jpg", "options": [] },
            { "id": "happy-birthday-97", "name": { "en": "happy birthday 97", "ne": "जन्मदिनको शुभकामना ९७" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/hFVV9NCh/e81742454f48bed7a13fbfad8bf8022a.jpg", "options": [] },
            { "id": "happy-birthday-98", "name": { "en": "happy birthday 98", "ne": "जन्मदिनको शुभकामना ९८" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/Dg5rhyf2/eabbe1ec61a8ff4a989b7c7ff0b90cf3.jpg", "options": [] },
            { "id": "happy-birthday-99", "name": { "en": "happy birthday 99", "ne": "जन्मदिनको शुभकामना ९९" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/0RfV2VJm/ec1b0ed493daa45db2f1d853530e23d3.jpg", "options": [] },
            { "id": "happy-birthday-100", "name": { "en": "happy birthday 100", "ne": "जन्मदिनको शुभकामना १००" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/2f97WfK/f5f9dd51165d2401f3cdbabb162f4016.jpg", "options": [] },
            { "id": "happy-birthday-101", "name": { "en": "happy birthday 101", "ne": "जन्मदिनको शुभकामना १०१" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/VWhf0K9V/f24753a8116df2d61314731aa5f66872.jpg", "options": [] },
            { "id": "happy-birthday-102", "name": { "en": "happy birthday 102", "ne": "जन्मदिनको शुभकामना १०२" }, "category": "happy-birthday", "imageSrc": "https://i.ibb.co/jvHj4VWP/fc40ab918e0bd83eaafebc1c8d4acebd.jpg", "options": [] },
            { "id": "cup-print-39", "name": { "en": "CUP PRINT 39", "ne": "कप प्रिन्ट ३९" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/XfqbsHWK/2.jpg", "options": [] },
            { "id": "cup-print-40", "name": { "en": "CUP PRINT 40", "ne": "कप प्रिन्ट ४०" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/7d4nTfFd/3.jpg", "options": [] },
            { "id": "cup-print-41", "name": { "en": "CUP PRINT 41", "ne": "कप प्रिन्ट ४१" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/wFYFzmk3/4.jpg", "options": [] },
            { "id": "cup-print-42", "name": { "en": "CUP PRINT 42", "ne": "कप प्रिन्ट ४२" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/k6DxkjYd/5.jpg", "options": [] },
            { "id": "cup-print-43", "name": { "en": "CUP PRINT 43", "ne": "कप प्रिन्ट ४३" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/yF24zKpL/6.jpg", "options": [] },
            { "id": "cup-print-44", "name": { "en": "CUP PRINT 44", "ne": "कप प्रिन्ट ४४" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/Wvjk4BtV/7.jpg", "options": [] },
            { "id": "cup-print-45", "name": { "en": "CUP PRINT 45", "ne": "कप प्रिन्ट ४५" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/Y4dDcSZv/8.jpg", "options": [] },
            { "id": "cup-print-46", "name": { "en": "CUP PRINT 46", "ne": "कप प्रिन्ट ४६" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/mrZgJBTd/9.jpg", "options": [] },
            { "id": "cup-print-47", "name": { "en": "CUP PRINT 47", "ne": "कप प्रिन्ट ४७" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/RVMxRgK/11.jpg", "options": [] },
            { "id": "cup-print-48", "name": { "en": "CUP PRINT 48", "ne": "कप प्रिन्ट ४८" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/4Z7dVpdL/13.jpg", "options": [] },
            { "id": "cup-print-49", "name": { "en": "CUP PRINT 49", "ne": "कप प्रिन्ट ४९" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/0pqS3fhW/14.jpg", "options": [] },
            { "id": "cup-print-50", "name": { "en": "CUP PRINT 50", "ne": "कप प्रिन्ट ५०" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/3YRVWWQc/16.jpg", "options": [] },
            { "id": "logo-cup-print-51", "name": { "en": "LOGO Cup Print 51", "ne": "लोगो कप प्रिन्ट ५१" }, "category": "cup-print", "imageSrc": "https://i.ibb.co/prNrCYKj/temp-Image-OGs-Yx-S.jpg", "options": [] },
            { "id": "neymar-canvas-52", "name": { "en": "NEYMAR 1 Canvas 52", "ne": "नेयमार १ क्यानभास ५२" }, "category": "canvas", "imageSrc": "https://i.ibb.co/gFXnqdxN/63773a97ff5a414c3caddc7091d8c6bf.jpg", "options": [] },
            { "id": "certificate-53", "name": { "en": "Certificate 53", "ne": "प्रमाणपत्र ५३" }, "category": "canvas", "imageSrc": "https://i.ibb.co/jkknP1Vy/Whats-App-Image-2025-07-06-at-8-07-35-pm.jpg", "options": [] },
            { "id": "birthday-frame-54", "name": { "en": "Birthday frame 54", "ne": "जन्मदिन फ्रेम ५४" }, "category": "canvas", "imageSrc": "https://i.ibb.co/R1gMXWV/Whats-App-Image-2025-06-30-at-5-45-20-pm.jpg", "options": [] },
            { "id": "poster-55", "name": { "en": "Poster 55", "ne": "पोस्टर ५५" }, "category": "canvas", "imageSrc": "https://i.ibb.co/gbbQwPfm/12.jpg", "options": [] },
            { "id": "102", "name": { "en": "Flex Board Banner 102", "ne": "फ्लेक्स बोर्ड ब्यानर १०२" }, "category": "flex", "imageSrc": "https://i.ibb.co/HLRmDHkr/1.jpg", "options": [] },
            { "id": "103", "name": { "en": "Flex Board Banner 103", "ne": "फ्लेक्स बोर्ड ब्यानर १०३" }, "category": "flex", "imageSrc": "https://i.ibb.co/7dPLkrmv/2.jpg", "options": [] },
            { "id": "104", "name": { "en": "Flex Board Banner 104", "ne": "फ्लेक्स बोर्ड ब्यानर १०४" }, "category": "flex", "imageSrc": "https://i.ibb.co/rP5vqY9/3.jpg", "options": [] },
            { "id": "105", "name": { "en": "Flex Board Banner 105", "ne": "फ्लेक्स बोर्ड ब्यानर १०५" }, "category": "flex", "imageSrc": "https://i.ibb.co/KZHtyVb/4.jpg", "options": [] },
            { "id": "106", "name": { "en": "Flex Board Banner 106", "ne": "फ्लेक्स बोर्ड ब्यानर १०६" }, "category": "flex", "imageSrc": "https://i.ibb.co/k6Q7sxy7/5.jpg", "options": [] },
            { "id": "107", "name": { "en": "Flex Board Banner 107", "ne": "फ्लेक्स बोर्ड ब्यानर १०७" }, "category": "flex", "imageSrc": "https://i.ibb.co/PGfc30Pn/6.jpg", "options": [] },
            { "id": "108", "name": { "en": "Flex Board Banner 108", "ne": "फ्लेक्स बोर्ड ब्यानर १०८" }, "category": "flex", "imageSrc": "https://i.ibb.co/Nn6d9FFd/7.jpg", "options": [] },
            { "id": "109", "name": { "en": "Flex Board Banner 109", "ne": "फ्लेक्स बोर्ड ब्यानर १०९" }, "category": "flex", "imageSrc": "https://i.ibb.co/CpWzMSyQ/8.jpg", "options": [] },
            { "id": "110", "name": { "en": "Flex Board Banner 110", "ne": "फ्लेक्स बोर्ड ब्यानर ११०" }, "category": "flex", "imageSrc": "https://i.ibb.co/qFgYb8gp/9.jpg", "options": [] },
            { "id": "111", "name": { "en": "Flex Board Banner 111", "ne": "फ्लेक्स बोर्ड ब्यानर १११" }, "category": "flex", "imageSrc": "https://i.ibb.co/b54fzpx3/10.jpg", "options": [] },
            { "id": "112", "name": { "en": "Flex Board Banner 112", "ne": "फ्लेक्स बोर्ड ब्यानर ११२" }, "category": "flex", "imageSrc": "https://i.ibb.co/svWmkhXH/11.jpg", "options": [] },
            { "id": "113", "name": { "en": "Flex Board Banner 113", "ne": "फ्लेक्स बोर्ड ब्यानर ११३" }, "category": "flex", "imageSrc": "https://i.ibb.co/WpM91H4m/12.jpg", "options": [] },
            { "id": "114", "name": { "en": "Flex Board Banner 114", "ne": "फ्लेक्स बोर्ड ब्यानर ११४" }, "category": "flex", "imageSrc": "https://i.ibb.co/3YfKKZCW/13.jpg", "options": [] },
            { "id": "115", "name": { "en": "Flex Board Banner 115", "ne": "फ्लेक्स बोर्ड ब्यानर ११५" }, "category": "flex", "imageSrc": "https://i.ibb.co/1Y9HHJ1c/14.jpg", "options": [] },
            { "id": "116", "name": { "en": "Flex Board Banner 116", "ne": "फ्लेक्स बोर्ड ब्यानर ११६" }, "category": "flex", "imageSrc": "https://i.ibb.co/zWknyDzz/15.jpg", "options": [] },
            { "id": "117", "name": { "en": "Flex Board Banner 117", "ne": "फ्लेक्स बोर्ड ब्यानर ११७" }, "category": "flex", "imageSrc": "https://i.ibb.co/6RCWHLsP/16.jpg", "options": [] },
            { "id": "118", "name": { "en": "Flex Board Banner 118", "ne": "फ्लेक्स बोर्ड ब्यानर ११८" }, "category": "flex", "imageSrc": "https://i.ibb.co/3y51wHLG/17.jpg", "options": [] },
            { "id": "119", "name": { "en": "Flex Board Banner 119", "ne": "फ्लेक्स बोर्ड ब्यानर ११९" }, "category": "flex", "imageSrc": "https://i.ibb.co/R4jNWWpm/18.jpg", "options": [] },
            { "id": "120", "name": { "en": "Flex Board Banner 120", "ne": "फ्लेक्स बोर्ड ब्यानर १२०" }, "category": "flex", "imageSrc": "https://i.ibb.co/whPGwKNd/19.jpg", "options": [] },
            { "id": "121", "name": { "en": "Flex Board Banner 121", "ne": "फ्लेक्स बोर्ड ब्यानर १२१" }, "category": "flex", "imageSrc": "https://i.ibb.co/rGmL27ZG/21.jpg", "options": [] },
            { "id": "122", "name": { "en": "Flex Board Banner 122", "ne": "फ्लेक्स बोर्ड ब्यानर १२२" }, "category": "flex", "imageSrc": "https://i.ibb.co/ZRjr5MzF/23.jpg", "options": [] },
            { "id": "123", "name": { "en": "Flex Board Banner 123", "ne": "फ्लेक्स बोर्ड ब्यानर १२३" }, "category": "flex", "imageSrc": "https://i.ibb.co/vxCpkLvV/24.jpg", "options": [] },
            { "id": "124", "name": { "en": "Flex Board Banner 124", "ne": "फ्लेक्स बोर्ड ब्यानर १२४" }, "category": "flex", "imageSrc": "https://i.ibb.co/20xkjC1j/25.jpg", "options": [] },
            { "id": "125", "name": { "en": "Flex Board Banner 125", "ne": "फ्लेक्स बोर्ड ब्यानर १२५" }, "category": "flex", "imageSrc": "https://i.ibb.co/p6Q27K7K/26.jpg", "options": [] },
            { "id": "126", "name": { "en": "Flex Board Banner 126", "ne": "फ्लेक्स बोर्ड ब्यानर १२६" }, "category": "flex", "imageSrc": "https://i.ibb.co/mFGPvNWG/27.jpg", "options": [] },
            { "id": "neymar-canvas-56", "name": { "en": "NEYMAR 2 Canvas 56", "ne": "नेयमार २ क्यानभास ५६" }, "category": "canvas", "imageSrc": "https://i.ibb.co/V0gJXcCj/18440bfc3de9671c8d54f39d3eeb906b.jpg", "options": [] },
            { "id": "logo-sticker-58", "name": { "en": "Logo Sticker 58", "ne": "लोगो स्टिकर ५८" }, "category": "sticker", "imageSrc": "https://i.ibb.co/jkFJ4TNK/Sticker-Printing.jpg", "options": [] },
            { "id": "tshirt-print-59", "name": { "en": "T-SHIRT Print 59", "ne": "टिसर्ट प्रिन्ट ५९" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/fYY55x1L/1.jpg", "options": [] },
            { "id": "tshirt-print-60", "name": { "en": "T-SHIRT Print 60", "ne": "टिसर्ट प्रिन्ट ६०" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/LXMxScCJ/2.jpg", "options": [] },
            { "id": "tshirt-print-61", "name": { "en": "T-SHIRT Print 61", "ne": "टिसर्ट प्रिन्ट ६१" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/yBdCGj69/3.jpg", "options": [] },
            { "id": "tshirt-print-62", "name": { "en": "T-SHIRT Print 62", "ne": "टिसर्ट प्रिन्ट ६२" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/Y7GYYXkc/4.jpg", "options": [] },
            { "id": "tshirt-print-63", "name": { "en": "T-SHIRT Print 63", "ne": "टिसर्ट प्रिन्ट ६३" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/LhcJHwBk/5.jpg", "options": [] },
            { "id": "tshirt-print-64", "name": { "en": "T-SHIRT Print 64", "ne": "टिसर्ट प्रिन्ट ६४" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/QjxJnHJG/6.jpg", "options": [] },
            { "id": "tshirt-print-65", "name": { "en": "T-SHIRT Print 65", "ne": "टिसर्ट प्रिन्ट ६५" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/Y79jnZ0B/7.jpg", "options": [] },
            { "id": "tshirt-print-66", "name": { "en": "T-SHIRT Print 66", "ne": "टिसर्ट प्रिन्ट ६६" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/d43L1R8z/8.jpg", "options": [] },
            { "id": "tshirt-print-67", "name": { "en": "T-SHIRT Print 67", "ne": "टिसर्ट प्रिन्ट ६७" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/99zs7Pnh/9.jpg", "options": [] },
            { "id": "tshirt-print-68", "name": { "en": "T-SHIRT Print 68", "ne": "टिसर्ट प्रिन्ट ६८" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/TBmBH52x/10.jpg", "options": [] },
            { "id": "tshirt-print-69", "name": { "en": "T-SHIRT Print 69", "ne": "टिसर्ट प्रिन्ट ६९" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/v9FLb6t/11.jpg", "options": [] },
            { "id": "tshirt-print-70", "name": { "en": "T-SHIRT Print 70", "ne": "टिसर्ट प्रिन्ट ७०" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/k21R4gG3/12.jpg", "options": [] },
            { "id": "tshirt-print-71", "name": { "en": "T-SHIRT Print 71", "ne": "टिसर्ट प्रिन्ट ७१" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/5Xqy2mpt/13.jpg", "options": [] },
            { "id": "tshirt-print-72", "name": { "en": "T-SHIRT Print 72", "ne": "टिसर्ट प्रिन्ट ७२" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/LDyfw0N3/15.jpg", "options": [] },
            { "id": "tshirt-print-73", "name": { "en": "T-SHIRT Print 73", "ne": "टिसर्ट प्रिन्ट ७३" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/7J6yHYp4/16.jpg", "options": [] },
            { "id": "tshirt-print-74", "name": { "en": "T-SHIRT Print 74", "ne": "टिसर्ट प्रिन्ट ७४" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/8DgjcLVY/17.jpg", "options": [] },
            { "id": "tshirt-print-75", "name": { "en": "T-SHIRT Print 75", "ne": "टिसर्ट प्रिन्ट ७५" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/HTqtP0ft/18.jpg", "options": [] },
            { "id": "tshirt-print-76", "name": { "en": "T-SHIRT Print 76", "ne": "टिसर्ट प्रिन्ट ७६" }, "category": "t-shirt", "imageSrc": "https://i.ibb.co/pvYJBZzD/19.jpg", "options": [] },
            { "id": "custom-stamp-127", "name": { "en": "Custom Rubber Stamp 127", "ne": "अनुकूलित रबर स्ट्याम्प १२७" }, "category": "stamp", "imageSrc": "https://i.ibb.co/XrNkhyXY/1.jpg", "options": [] },
            { "id": "custom-stamp-128", "name": { "en": "Custom Rubber Stamp 128", "ne": "अनुकूलित रबर स्ट्याम्प १२८" }, "category": "stamp", "imageSrc": "https://i.ibb.co/mrQ0PvPq/2.jpg", "options": [] }
            ]);
        }, 800);
    })
};

const I18n = {
    currentLang: 'en',
    translations: {
        en: { "nav.home": "Home", "nav.favorites": "Favorites", "cat.all": "All", "cat.favorites": "Favorites", "product.happy-birthday": "Happy Birthday", "product.t-shirt": "T-Shirt", "product.business-card": "Business Card", "product.cup-print": "Cup Print", "product.canvas": "Canvas", "product.flex": "Flex", "product.sticker": "Sticker", "product.stamp": "Stamp", "product.gadgets": "Gadgets", "product.clothes": "Clothes", "product.room-rent": "Room Rent", "product.bus-rent": "Bus Rent", "product.courier": "Courier Service", "cart.title": "Your Cart", "cart.empty": "Your cart is empty.", "cart.checkout": "Checkout to WhatsApp", "cart.add": "Add to Cart", "toast.copied": "Order copied! Please paste in chat.", "toast.cartAdded": "Added to cart!", "toast.cartRemoved": "Removed from cart", "settings.title": "Settings", "settings.theme": "Theme", "settings.fontSize": "Font Size", "settings.language": "Language", "search.placeholder": "Search products...", "search.noResults": "No products found.", "contact.whatsapp": "Contact on WhatsApp", "contact.booking": "Contact for Booking", "contact.courier": "Contact for Courier", "buy": "Buy", "product.rs_prefix": "Rs.", "contact_person_prefix": "Contact:", "operator_prefix": "Operator:", "bus_no_prefix": "Bus No:" },
        ne: { "nav.home": "गृह", "nav.favorites": "मनपर्ने", "cat.all": "सबै", "cat.favorites": "मनपर्ने", "product.happy-birthday": "जन्मदिनको शुभकामना", "product.t-shirt": "टिसर्ट", "product.business-card": "बिजनेस कार्ड", "product.cup-print": "कप प्रिन्ट", "product.canvas": "क्यानभास", "product.flex": "फ्लेक्स", "product.sticker": "स्टिकर", "product.stamp": "छाप", "product.gadgets": "ग्याजेटहरू", "product.clothes": "कपडा", "product.room-rent": "कोठा भाडा", "product.bus-rent": "बस भाडा", "product.courier": "कुरियर सेवा", "cart.title": "तपाईंको कार्ट", "cart.empty": "तपाईंको कार्ट खाली छ।", "cart.checkout": "WhatsApp मा अर्डर गर्नुहोस्", "cart.add": "कार्टमा राख्नुहोस्", "toast.copied": "अर्डर प्रतिलिपि भयो! कृपया च्याटमा टाँस्नुहोस्।", "toast.cartAdded": "कार्टमा थपियो!", "toast.cartRemoved": "कार्टबाट हटाइयो", "settings.title": "सेटिङहरू", "settings.theme": "थिम", "settings.fontSize": "फन्ट साइज", "settings.language": "भाषा", "search.placeholder": "उत्पादनहरू खोज्नुहोस्...", "search.noResults": "कुनै उत्पादन फेला परेन।", "contact.whatsapp": "WhatsApp मा सम्पर्क गर्नुहोस्", "contact.booking": "बुकिङको लागि सम्पर्क गर्नुहोस्", "contact.courier": "कुरियरको लागि सम्पर्क गर्नुहोस्", "buy": "किन्नुहोस्", "product.rs_prefix": "रु.", "contact_person_prefix": "सम्पर्क:", "operator_prefix": "अपरेटर:", "bus_no_prefix": "बस नं:" }
    },
    t(key) { return this.translations[this.currentLang]?.[key] || key; },
    setLanguage(lang) {
        if (!this.translations[lang]) return;
        this.currentLang = lang;
        document.documentElement.lang = lang;
        document.querySelectorAll('[data-i18n-key]').forEach(el => { el.textContent = this.t(el.dataset.i18nKey); });
        App.ui.renderProducts();
    }
};

const Utils = {
    debounce: (func, delay) => { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; },
    throttle: (func, limit) => { let inThrottle; return function() { const args = arguments; const context = this; if (!inThrottle) { func.apply(context, args); inThrottle = true; setTimeout(() => inThrottle = false, limit); } } },
    generateId: () => `id_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
};

const App = {
    config: { WHATSAPP_NUMBER: '9761614027' },
    state: { products: [], activeFilter: 'all', viewMode: 'grid', favorites: [], lang: 'en' },
    dom: {},
    
    init() {
        document.addEventListener('DOMContentLoaded', () => {
            this.dom = this.cacheDom();
            this.logic.loadState();
            this.events.setupEventListeners();
            this.logic.fetchAndRenderAll();
        });
    },

    cacheDom() {
        return {
            body: document.body, productGrid: document.getElementById('product-grid'), categoryNav: document.getElementById('category-nav'), searchInput: document.getElementById('search-input'), clearSearchBtn: document.getElementById('clear-search-btn'), settingsBtn: document.getElementById('settings-btn'), zoomModal: document.getElementById('image-zoom-modal'), zoomedImage: document.getElementById('zoomed-image-src'), toastContainer: document.getElementById('toast-container'), backToTopBtn: document.getElementById('back-to-top'), categoryNavWrapper: document.querySelector('.category-nav-wrapper'), cartToggleBtn: document.getElementById('cart-toggle-btn'), cartPanel: document.getElementById('cart-panel'), cartCloseBtn: document.getElementById('cart-close-btn'), cartItemsContainer: document.getElementById('cart-items-container'), cartBadge: document.getElementById('cart-badge'), checkoutBtn: document.getElementById('checkout-btn'), productCount: document.getElementById('product-count'), settingsModal: document.getElementById('settings-modal'), settingsModalContent: document.getElementById('settings-modal-content'),
            desktopNav: document.querySelector('.desktop-nav'), mobileNav: document.querySelector('.mobile-bottom-nav'),
            desktopHomeBtn: document.getElementById('desktop-home-btn'), desktopFavBtn: document.getElementById('desktop-fav-btn'),
            mobileHomeBtn: document.getElementById('mobile-home-btn'), mobileFavBtn: document.getElementById('mobile-fav-btn')
        };
    },

    logic: {
        async fetchAndRenderAll() {
            try {
                const products = await MockAPI.fetchProducts();
                App.state.products = products;
                I18n.setLanguage(App.state.lang);
            } catch (error) {
                console.error("Failed to fetch products:", error);
                App.dom.productGrid.innerHTML = `<p>Error loading products. Please try again later.</p>`;
            }
        },
        loadState() {
            App.state.theme = localStorage.getItem('theme') || 'light';
            App.state.fontSize = parseInt(localStorage.getItem('fontSize'), 10) || 16;
            App.state.favorites = JSON.parse(localStorage.getItem('favorites')) || [];
            App.state.lang = localStorage.getItem('lang') || 'en';
            
            App.ui.applyTheme(App.state.theme);
            App.ui.applyFontSize(App.state.fontSize);
            Cart.load();
        },
        saveState(key, value) { localStorage.setItem(key, JSON.stringify(value)); },
    },
    
    ui: {
        renderProductCard(product) {
            if (product.isCustom) {
                switch (product.category) {
                    case 'gadgets': return this.renderFacebookGadgetCard(product);
                    case 'room-rent': return this.renderRoomRentalCard(product);
                    case 'bus-rent': return this.renderBusRentCard(product);
                    case 'courier': return this.renderCourierCard(product);
                }
            }
            return this.renderStandardProductCard(product);
        },
        renderFacebookGadgetCard(product) {
            const { description, previewImages, rating, seller, price, whatsappNumber } = product.data;
            const productName = getText(product.name);
            const displayPrice = I18n.currentLang === 'ne' ? toNepaliNumerals(price) : price;
            const message = I18n.currentLang === 'ne' 
                ? `नमस्ते, मलाई "${productName}" (ID: ${toNepaliNumerals(product.id)}) रु. ${displayPrice} मा किन्न मन छ।`
                : `Hello, I would like to buy "${productName}" (ID: ${product.id}) for Rs. ${displayPrice}.`;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            let starsHTML = '';
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5 ? 1 : 0;
            for (let i = 0; i < fullStars; i++) starsHTML += '<i class="fas fa-star"></i>';
            if (halfStar) starsHTML += '<i class="fas fa-star-half-alt"></i>';

            return `
                <article class="product-card product-card-facebook" data-id="${product.id}" data-category="${product.category}">
                    <h3>${productName}</h3>
                    <p class="description">${getText(description)}</p>
                    <div class="image-previews">${previewImages.map(src => `<img src="${src}" alt="${productName}">`).join('')}</div>
                    <div class="rating-container">
                        <span class="rating-value">${I18n.currentLang === 'ne' ? toNepaliNumerals(String(rating)) : rating}</span>
                        <div class="stars">${starsHTML}</div>
                    </div>
                    <div class="custom-footer">
                        <span class="seller-name">${getText(seller)}</span>
                        <span class="price">${I18n.t('product.rs_prefix')} ${displayPrice}</span>
                        <a href="${whatsappUrl}" target="_blank" class="buy-btn">${I18n.t('buy')}</a>
                    </div>
                </article>`;
        },
        renderRoomRentalCard(product) {
            const isFavorited = App.state.favorites.includes(product.id);
            const { seller, address, price, whatsappNumber } = product.data;
            const productName = getText(product.name);
            const message = I18n.currentLang === 'ne'
                ? `नमस्ते, मैले रुबिक्सथा अफिसियलमा "${productName}" (${getText(address)}) को विज्ञापन देखेको थिएँ। के यो अझै भाडामा उपलब्ध छ?`
                : `Hello, I saw the ad for "${productName}" at ${getText(address)} on RubiXtha Official. Is it still available for rent?`;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

            return `
                <article class="product-card product-card-room" data-id="${product.id}" data-category="${product.category}">
                    <div class="product-image"><img src="${product.imageSrc}" alt="${productName}" loading="lazy"><div class="fav-btn ${isFavorited ? 'favorited' : ''}"><i class="fa-${isFavorited ? 'solid' : 'regular'} fa-heart"></i></div></div>
                    <div class="product-content">
                        <h3>${productName}</h3>
                        <div class="service-details">
                            <p class="service-info"><i class="fas fa-map-marker-alt"></i> <span>${getText(address)}</span></p>
                            <p class="service-info"><i class="fas fa-user-tie"></i> <span>${I18n.t('contact_person_prefix')} ${getText(seller)}</span></p>
                            <p class="service-price-info"><i class="fas fa-tag"></i> <strong>${getText(price)}</strong></p>
                        </div>
                        <div class="card-footer"><a href="${whatsappUrl}" target="_blank" class="whatsapp-buy-btn"><i class="fab fa-whatsapp"></i> ${I18n.t('contact.whatsapp')}</a></div>
                    </div>
                </article>`;
        },
        renderBusRentCard(product) {
            const isFavorited = App.state.favorites.includes(product.id);
            const { busName, busNumber, seller, whatsappNumber } = product.data;
            const productName = getText(product.name);
            const message = I18n.currentLang === 'ne'
                ? `नमस्ते, मलाई रुबिक्सथा अफिसियलमा देखाइएको ${getText(busName)} (बस नं: ${getText(busNumber)}) भाडामा लिन रुचि छ। थप विवरण दिन सक्नुहुन्छ?`
                : `Hello, I'm interested in renting the ${getText(busName)} (Bus No: ${getText(busNumber)}) as seen on RubiXtha Official. Can you provide more details?`;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

            return `
                <article class="product-card product-card-bus" data-id="${product.id}" data-category="${product.category}">
                    <div class="product-image"><img src="${product.imageSrc}" alt="${productName}" loading="lazy"><div class="fav-btn ${isFavorited ? 'favorited' : ''}"><i class="fa-${isFavorited ? 'solid' : 'regular'} fa-heart"></i></div></div>
                    <div class="product-content">
                        <h3>${productName}</h3>
                        <div class="service-details">
                            <p class="service-info"><i class="fas fa-bus"></i> <span>${getText(busName)}</span></p>
                            <p class="service-info"><i class="fas fa-hashtag"></i> <span>${getText(busNumber)}</span></p>
                            <p class="service-info"><i class="fas fa-user-tie"></i> <span>${I18n.t('contact_person_prefix')} ${getText(seller)}</span></p>
                        </div>
                        <div class="card-footer"><a href="${whatsappUrl}" target="_blank" class="whatsapp-buy-btn"><i class="fab fa-whatsapp"></i> ${I18n.t('contact.booking')}</a></div>
                    </div>
                </article>`;
        },
        renderCourierCard(product) {
            const isFavorited = App.state.favorites.includes(product.id);
            const { ownerName, busNumber, route, whatsappNumber } = product.data;
            const productName = getText(product.name);
            const message = I18n.currentLang === 'ne'
                ? `नमस्ते, म बस नम्बर ${getText(busNumber)} मार्फत गजुरीबाट काठमाडौं सामान पठाउन चाहन्छु। के तपाईं उपलब्ध हुनुहुन्छ? (रुबिक्सथा अफिसियलबाट)`
                : `Hello, I want to send a parcel from Gajuri to Kathmandu via bus number ${getText(busNumber)}. Are you available? (from RubiXtha Official)`;
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;

            return `
                <article class="product-card product-card-courier" data-id="${product.id}" data-category="${product.category}">
                    <div class="product-image"><img src="${product.imageSrc}" alt="${productName}" loading="lazy"><div class="fav-btn ${isFavorited ? 'favorited' : ''}"><i class="fa-${isFavorited ? 'solid' : 'regular'} fa-heart"></i></div></div>
                    <div class="product-content">
                        <h3>${productName}</h3>
                        <div class="service-details">
                            <p class="service-info"><i class="fas fa-route"></i> <span>${getText(route)}</span></p>
                            <p class="service-info"><i class="fas fa-user"></i> <span>${I18n.t('operator_prefix')} ${getText(ownerName)}</span></p>
                            <p class="service-info"><i class="fas fa-bus"></i> <span>${I18n.t('bus_no_prefix')} ${getText(busNumber)}</span></p>
                        </div>
                        <div class="card-footer"><a href="${whatsappUrl}" target="_blank" class="whatsapp-buy-btn"><i class="fab fa-whatsapp"></i> ${I18n.t('contact.courier')}</a></div>
                    </div>
                </article>`;
        },
        renderStandardProductCard(product) {
            const isFavorited = App.state.favorites.includes(product.id);
            const productName = getText(product.name);
            const createOptionHTML = (opt) => {
                 let inputHTML;
                 const attributes = opt.attributes ? Object.entries(opt.attributes).map(([key, value]) => `${key}="${value}"`).join(' ') : '';
                 if (opt.type === 'select') {
                     const optionTags = opt.values.map(val => `<option value="${getText(val)}">${getText(val)}</option>`).join('');
                     inputHTML = `<select class="option-input" data-option-name-en="${opt.name}" data-option-name-ne="${getText(opt.label)}">${optionTags}</select>`;
                 } else {
                     inputHTML = `<input type="${opt.type}" class="option-input" data-option-name-en="${opt.name}" data-option-name-ne="${getText(opt.label)}" ${attributes}>`;
                 }
                 return `<div class="option-group"><label>${getText(opt.label)}:</label>${inputHTML}</div>`;
            };
            const hasOptions = product.options && product.options.length > 0;

            return `
                <article class="product-card" data-id="${product.id}" data-category="${product.category}">
                    <div class="product-image"><img src="${product.imageSrc}" alt="${productName}" loading="lazy"><div class="fav-btn ${isFavorited ? 'favorited' : ''}"><i class="fa-${isFavorited ? 'solid' : 'regular'} fa-heart"></i></div></div>
                    <div class="product-content">
                        <h3>${productName}</h3>
                        ${hasOptions ? `<div class="product-options">${product.options.map(createOptionHTML).join('')}</div>` : ''}
                        <div class="card-footer"><button class="add-to-cart-btn" data-i18n-key="cart.add">${I18n.t('cart.add')}</button></div>
                    </div>
                </article>`;
        },
        renderProducts() { 
            this.renderCategories();
            this.filterAndSearch();
        },
        renderCategories() {
            const categories = [...new Set(App.state.products.map(p => p.category))];
            let buttonsHTML = `<button class="filter-btn" data-filter="all" data-i18n-key="cat.all">${I18n.t('cat.all')}</button>`;
            buttonsHTML += categories.map(cat => `<button class="filter-btn" data-filter="${cat}" data-i18n-key="product.${cat}">${I18n.t(`product.${cat}`)}</button>`).join('');
            App.dom.categoryNav.innerHTML = buttonsHTML;
            App.dom.categoryNav.querySelector(`[data-filter="${App.state.activeFilter}"]`)?.classList.add('active');
            this.updateFavoritesUI();
        },
        filterAndSearch() {
            const searchTerm = App.dom.searchInput.value.toLowerCase();
            const filteredProducts = App.state.products.filter(product => {
                const categoryMatch = (App.state.activeFilter === 'all' || App.state.activeFilter === product.category || (App.state.activeFilter === 'favorites' && App.state.favorites.includes(product.id)));
                const searchMatch = getText(product.name).toLowerCase().includes(searchTerm);
                return categoryMatch && searchMatch;
            });
            App.dom.productGrid.innerHTML = filteredProducts.length ? filteredProducts.map(p => this.renderProductCard(p)).join('') : `<p data-i18n-key="search.noResults">${I18n.t('search.noResults')}</p>`;
            App.dom.productGrid.classList.remove('loading');
            
            const countText = I18n.currentLang === 'ne' 
                ? `${toNepaliNumerals(filteredProducts.length)} उत्पादनहरू फेला परे।`
                : `${filteredProducts.length} products found.`;
            App.dom.productCount.textContent = countText;

            App.dom.searchInput.placeholder = I18n.t('search.placeholder');
        },
        applyTheme(theme) { document.body.dataset.theme = theme; },
        applyFontSize(size) { document.documentElement.style.fontSize = `${size}px`; },
        showModal(modalId) { document.getElementById(modalId).classList.add('visible'); },
        hideModal(modalId) { document.getElementById(modalId).classList.remove('visible'); },
        showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            App.dom.toastContainer.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, duration);
        },
        updateFavoritesUI() {
            let favBtn = App.dom.categoryNav.querySelector('[data-filter="favorites"]');
            const hasFavorites = App.state.favorites.length > 0;
            if (hasFavorites) {
                if (!favBtn) {
                    favBtn = document.createElement('button');
                    favBtn.className = 'filter-btn';
                    favBtn.dataset.filter = 'favorites';
                    favBtn.dataset.i18nKey = 'cat.favorites';
                    favBtn.innerHTML = `${I18n.t('cat.favorites')} <span class="fav-count"></span>`;
                    App.dom.categoryNav.appendChild(favBtn);
                }
                const favCount = I18n.currentLang === 'ne' ? toNepaliNumerals(App.state.favorites.length) : App.state.favorites.length;
                favBtn.querySelector('.fav-count').textContent = favCount;
            } else if (favBtn) { 
                favBtn.remove(); 
            }
            if (App.dom.mobileFavBtn) App.dom.mobileFavBtn.classList.toggle('hidden', !hasFavorites);
        },
    },
    
    events: {
        setupEventListeners() {
            App.dom.productGrid.addEventListener('click', this.handleGridInteraction);
            App.dom.categoryNav.addEventListener('click', this.handleFilterClick);
            App.dom.searchInput.addEventListener('input', Utils.debounce(() => App.ui.filterAndSearch(), 300));
            App.dom.clearSearchBtn.addEventListener('click', () => { App.dom.searchInput.value = ''; App.ui.filterAndSearch(); });
            App.dom.settingsBtn.addEventListener('click', () => Settings.open());
            App.dom.cartToggleBtn.addEventListener('click', () => Cart.toggle());
            App.dom.cartCloseBtn.addEventListener('click', () => Cart.hide());
            App.dom.cartItemsContainer.addEventListener('click', e => Cart.handleInteraction(e));
            App.dom.cartItemsContainer.addEventListener('input', e => Cart.handleInteraction(e));
            App.dom.checkoutBtn.addEventListener('click', () => Cart.checkout());
            document.addEventListener('click', e => { if (e.target.classList.contains('modal-overlay')) App.ui.hideModal(e.target.id); });
            document.addEventListener('keydown', e => { if (e.key === 'Escape') { Cart.hide(); App.ui.hideModal('settings-modal'); App.ui.hideModal('image-zoom-modal'); } });
            window.addEventListener('scroll', Utils.throttle(this.handleScroll, 100));
            App.dom.backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            const handleNavClick = (e, filter) => { e.preventDefault(); App.dom.categoryNav.querySelector(`[data-filter="${filter}"]`)?.click(); e.currentTarget.closest('nav')?.querySelector('.active')?.classList.remove('active'); e.currentTarget.classList.add('active'); };
            App.dom.desktopHomeBtn.addEventListener('click', e => handleNavClick(e, 'all'));
            App.dom.mobileHomeBtn.addEventListener('click', e => handleNavClick(e, 'all'));
            App.dom.desktopFavBtn.addEventListener('click', e => handleNavClick(e, 'favorites'));
            App.dom.mobileFavBtn.addEventListener('click', e => handleNavClick(e, 'favorites'));
        },
        handleGridInteraction(e) {
            const card = e.target.closest('.product-card, .product-card-facebook');
            if (!card) return;
            const productId = card.dataset.id;
            if (e.target.closest('.fav-btn')) {
                const isFavorited = App.state.favorites.includes(productId);
                App.state.favorites = isFavorited ? App.state.favorites.filter(id => id !== productId) : [...App.state.favorites, productId];
                App.logic.saveState('favorites', App.state.favorites);
                App.ui.renderProducts();
            } 
            else if (e.target.closest('.add-to-cart-btn')) { Cart.addFromCard(card); }
            else if (e.target.tagName === 'IMG' && e.target.closest('.product-image, .image-previews')) {
                App.dom.zoomedImage.src = e.target.src;
                App.ui.showModal('image-zoom-modal');
            }
        },
        handleFilterClick(e) { 
            const target = e.target.closest('.filter-btn');
            if(!target || target.classList.contains('active')) return;
            App.dom.categoryNav.querySelector('.active')?.classList.remove('active');
            target.classList.add('active');
            App.state.activeFilter = target.dataset.filter;
            App.ui.filterAndSearch();
        },
        handleViewToggle(view) {
            App.state.viewMode = view;
            App.dom.productGrid.classList.toggle('list-view', view === 'list');
        },
        handleScroll() {
            const isVisible = window.scrollY > 300;
            App.dom.backToTopBtn.style.display = 'grid';
            App.dom.backToTopBtn.classList.toggle('visible', isVisible);
            const headerHeight = document.querySelector('.main-header').offsetHeight;
            const isSticky = App.dom.categoryNavWrapper.getBoundingClientRect().top <= headerHeight;
            App.dom.categoryNavWrapper.classList.toggle('sticky', isSticky);
        },
    },
};

const Cart = {
    items: [],
    load() { this.items = JSON.parse(localStorage.getItem('cart')) || []; this.render(); },
    save() { localStorage.setItem('cart', JSON.stringify(this.items)); },
    addFromCard(card) {
        const productId = card.dataset.id;
        const product = App.state.products.find(p => p.id === productId);
        const optionsSummary = { en: [], ne: [] };
        card.querySelectorAll('.option-input').forEach(input => {
            if (!input.value) return;
            optionsSummary.en.push(`${input.dataset.optionNameEn}: ${input.value}`);
            optionsSummary.ne.push(`${input.dataset.optionNameNe}: ${toNepaliNumerals(input.value)}`);
        });
        const quantity = parseInt(card.querySelector('input[type="number"]')?.value || '1', 10);
        this.add({ cartItemId: Utils.generateId(), id: product.id, name: product.name, imageSrc: product.imageSrc, quantity, optionsSummary });
        App.ui.showToast(I18n.t('toast.cartAdded'), 'success');
    },
    add(item) { this.items.push(item); this.save(); this.render(); },
    remove(cartItemId) { this.items = this.items.filter(i => i.cartItemId !== cartItemId); this.save(); this.render(); App.ui.showToast(I18n.t('toast.cartRemoved'), 'error'); },
    updateQuantity(cartItemId, newQuantity) {
        const item = this.items.find(i => i.cartItemId === cartItemId);
        if (item) { if (newQuantity <= 0) { this.remove(cartItemId); return; } item.quantity = newQuantity; this.save(); this.render(); }
    },
    render() {
        const lang = I18n.currentLang;
        App.dom.cartItemsContainer.innerHTML = this.items.length === 0 ? `<p data-i18n-key="cart.empty">${I18n.t('cart.empty')}</p>` : 
            this.items.map(item => `
                <div class="cart-item" data-cart-item-id="${item.cartItemId}">
                    <img src="${item.imageSrc}" alt="${getText(item.name)}">
                    <div class="cart-item-details">
                        <div class="item-name">${getText(item.name)}</div>
                        <div class="item-options">${item.optionsSummary[lang].join(', ')}</div>
                        <div class="cart-item-actions">
                            <input type="number" value="${item.quantity}" min="1" class="option-input quantity-input">
                            <button class="remove-item-btn" title="Remove item">×</button>
                        </div>
                    </div>
                </div>`).join('');
        const totalItems = this.items.reduce((sum, item) => sum + item.quantity, 0);
        App.dom.cartBadge.textContent = lang === 'ne' ? toNepaliNumerals(totalItems) : totalItems;
        App.dom.cartBadge.classList.toggle('visible', totalItems > 0);
        App.dom.checkoutBtn.disabled = this.items.length === 0;
    },
    checkout() {
        const lang = I18n.currentLang;
        let message = lang === 'ne' ? `*रुबिक्सथा अफिसियलबाट नयाँ अर्डर अनुरोध*\n==================================\n\n` : `*New Order Request from RubiXtha Official*\n==================================\n\n`;
        this.items.forEach(item => {
            message += `${item.imageSrc}\n*${lang === 'ne' ? 'उत्पादन' : 'Product'}:* ${getText(item.name)}\n`;
            if (item.optionsSummary[lang].length > 0) { message += `*${lang === 'ne' ? 'विकल्पहरू' : 'Options'}:* ${item.optionsSummary[lang].join(', ')}\n`; }
            message += `*${lang === 'ne' ? 'मात्रा' : 'Quantity'}:* ${lang === 'ne' ? toNepaliNumerals(item.quantity) : item.quantity}\n----------------------------------\n`;
        });
        message += lang === 'ne' ? `\n*कृपया यो अर्डरको लागि मूल्य उपलब्ध गराउनुहोस्।*` : `\n*Please provide a quote for this order.*`;
        window.open(`https://wa.me/${App.config.WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`, '_blank');
    },
    toggle() { App.dom.cartPanel.classList.toggle('visible'); },
    hide() { App.dom.cartPanel.classList.remove('visible'); },
    handleInteraction(e) {
        const itemEl = e.target.closest('.cart-item');
        if (!itemEl) return;
        const cartItemId = itemEl.dataset.cartItemId;
        if (e.target.classList.contains('remove-item-btn')) this.remove(cartItemId);
        else if (e.target.classList.contains('quantity-input')) this.updateQuantity(cartItemId, parseInt(e.target.value, 10));
    }
};

const Settings = {
    open() {
        const { theme, fontSize, lang } = App.state;
        App.dom.settingsModalContent.innerHTML = `
            <button class="modal-close-btn" id="settings-close-btn">×</button>
            <h2 data-i18n-key="settings.title">${I18n.t('settings.title')}</h2>
            <div class="settings-group">
                <h3 data-i18n-key="settings.theme">${I18n.t('settings.theme')}</h3>
                <div class="theme-options">
                    <label><input type="radio" name="theme" value="light" class="visually-hidden" ${theme === 'light' ? 'checked' : ''}><span class="theme-swatch light"></span>Light</label>
                    <label><input type="radio" name="theme" value="dark" class="visually-hidden" ${theme === 'dark' ? 'checked' : ''}><span class="theme-swatch dark"></span>Dark</label>
                    <label><input type="radio" name="theme" value="sepia" class="visually-hidden" ${theme === 'sepia' ? 'checked' : ''}><span class="theme-swatch sepia"></span>Sepia</label>
                </div>
            </div>
            <div class="settings-group">
                <h3 data-i18n-key="settings.fontSize">${I18n.t('settings.fontSize')}</h3>
                <input type="range" id="font-size-slider" min="12" max="20" step="1" value="${fontSize}">
                <p>Current: <span id="font-size-value">${I18n.currentLang === 'ne' ? toNepaliNumerals(fontSize) : fontSize}px</span></p>
            </div>
            <div class="settings-group">
                <h3 data-i18n-key="settings.language">${I18n.t('settings.language')}</h3>
                <select id="language-select" class="option-input">
                    <option value="en" ${lang === 'en' ? 'selected' : ''}>English</option>
                    <option value="ne" ${lang === 'ne' ? 'selected' : ''}>नेपाली</option>
                </select>
            </div>
        `;
        App.dom.settingsModalContent.addEventListener('input', this.handleInteraction);
        App.dom.settingsModalContent.querySelector('#settings-close-btn').onclick = () => App.ui.hideModal('settings-modal');
        App.ui.showModal('settings-modal');
    },
    handleInteraction(e) {
        if(e.target.name === 'theme') { App.state.theme = e.target.value; App.ui.applyTheme(e.target.value); localStorage.setItem('theme', e.target.value); }
        if(e.target.id === 'font-size-slider') { 
            App.state.fontSize = e.target.value; 
            App.ui.applyFontSize(e.target.value); 
            localStorage.setItem('fontSize', e.target.value); 
            document.getElementById('font-size-value').textContent = `${I18n.currentLang === 'ne' ? toNepaliNumerals(e.target.value) : e.target.value}px`;
        }
        if(e.target.id === 'language-select') { App.state.lang = e.target.value; I18n.setLanguage(e.target.value); localStorage.setItem('lang', e.target.value); App.ui.hideModal('settings-modal'); }
    }
};

App.init();

window.onload = function() { document.getElementById('popupAd').style.display = 'block'; }
function closePopup() { document.getElementById('popupAd').style.display = 'none'; }
const waPopup = document.getElementById('waPopup');
const waLink = 'https://chat.whatsapp.com/KtcDbpOuXupCAWlPuljXdf';
waPopup.innerHTML = `<svg viewBox="0 0 24 24"><path d="M20.52 3.48A11.95 11.95 0 0012 0C5.37 0 .01 5.37 0 12c0 2.11.55 4.17 1.6 6.01L0 24l6.21-1.59A11.94 11.94 0 0012 24c6.63 0 12-5.37 12-12 0-3.2-1.25-6.2-3.48-8.52zM12 21.6c-1.98 0-3.88-.52-5.53-1.5l-.4-.24-3.69.95.96-3.6-.25-.38A9.6 9.6 0 012.4 12c0-5.31 4.29-9.6 9.6-9.6 2.56 0 4.96.99 6.77 2.8A9.53 9.53 0 0121.6 12c0 5.31-4.29 9.6-9.6 9.6z"/><path d="M17.48 14.02c-.26-.13-1.53-.76-1.77-.85-.24-.09-.42-.13-.6.13-.18.26-.72.85-.88 1.03-.16.18-.33.21-.6.07-.26-.13-1.1-.4-2.09-1.29-.77-.69-1.29-1.54-1.44-1.8-.15-.26-.02-.4.11-.53.11-.11.26-.28.38-.42.13-.15.18-.26.28-.43.09-.18.04-.33-.02-.46-.07-.13-.6-1.43-.82-1.96-.22-.52-.45-.45-.61-.46-.16-.01-.35-.01-.54-.01-.18 0-.47.07-.72.33-.25.25-.96.94-.96 2.29 0 1.35.98 2.65 1.12 2.83.13.18 1.92 2.92 4.66 3.98 2.74 1.06 2.74.71 3.23.67.48-.04 1.53-.62 1.75-1.22.22-.6.22-1.11.15-1.22-.07-.11-.24-.17-.5-.3z"/></svg>`;
setInterval(() => { waPopup.classList.add('show'); setTimeout(() => { waPopup.classList.remove('show'); }, 5000); }, 3000);
waPopup.addEventListener('click', () => { window.open(waLink, '_blank'); });
</script>

</body>
</html>
